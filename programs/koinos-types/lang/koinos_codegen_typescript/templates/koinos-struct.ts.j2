{% set className = ts_name(decl["name"]) %}{% for dep in dependencies %}import { {{", ".join(dep[0])}} } from "{{dep[1]}}";
{% endfor%}
export interface Json{{className}} { {% for field in decl["fields"]%}
  {{field["name"]}}: {{typereflike(field["tref"])}};{% endfor %}
}

export class {{className}} {
  {% for field in decl["fields"]%}public {{field["name"]}}: {{typeref(field["tref"])}};
  
  {% endfor %}constructor(
    json: Json{{className}} = { {% for field in decl["fields"]%}
      {{field["name"]}}: undefined,{% endfor %}
    }
  ) { {% for field in decl["fields"] %}
    this.{{field["name"]}} = new {{typeref_constructor(field["tref"])}}json.{{field["name"]}});{% endfor %}
  }

  serialize(blob?: VariableBlob): VariableBlob {
    const vb = blob || new VariableBlob(this.calcSerializedSize());{% for field in decl["fields"] %}
    vb.serialize(this.{{field["name"]}});{% endfor %}
    if (!blob) vb.resetCursor();
    return vb;
  }

  static deserialize(vb: VariableBlob): {{className}} {
    {% for field in decl["fields"] %}const {{field["name"]}} = vb.{{deserializeType(field["tref"])}};
    {% endfor %}return new {{className}}({ {% for field in decl["fields"] %}{{field["name"]}}{% if not loop.last %},{% endif%} {% endfor %}});
  }

  calcSerializedSize(): number {
    return {% for field in decl["fields"] %}this.{{field["name"]}}.calcSerializedSize(){{" +" if not loop.last}}{{";" if loop.last}}
  {% endfor %}{{"0;" if len(decl["fields"]) == 0 }} }

  toJSON(): Json{{className}} {
    return { {% for field in decl["fields"] %}
      {{field["name"]}}: this.{{field["name"]}}.toJSON(),{% endfor %}
    };
  }
}

export default {{className}};
